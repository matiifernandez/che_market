<h2 class="text-lg font-semibold text-gray-900 mb-4"><%= t('cart.summary') %></h2>

<div class="space-y-3 mb-6">
  <div class="flex justify-between text-gray-600">
    <span><%= t('cart.subtotal') %> (<%= t('cart.products_count', count: cart.items_count) %>)</span>
    <span><%= humanized_money_with_symbol(cart.subtotal) %></span>
  </div>

  <% if cart.coupon.present? %>
    <div class="flex justify-between text-green-600">
      <span class="flex items-center gap-2">
        <%= t('cart.discount') %> (<%= cart.coupon.code %>)
        <%= button_to remove_coupon_cart_path, method: :delete, class: "text-red-500 hover:text-red-700", data: { turbo: false } do %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        <% end %>
      </span>
      <span>-<%= humanized_money_with_symbol(cart.discount) %></span>
    </div>
  <% end %>

  <% if cart.gift_card.present? %>
    <div class="flex justify-between text-purple-600">
      <span class="flex items-center gap-2">
        <%= t('cart.gift_card_credit') %>
        <span class="text-xs text-gray-500">(<%= cart.gift_card.code.last(8) %>)</span>
        <%= button_to remove_gift_card_cart_path, method: :delete, class: "text-red-500 hover:text-red-700", data: { turbo: false } do %>
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        <% end %>
      </span>
      <span>-<%= humanized_money_with_symbol(cart.gift_card_credit) %></span>
    </div>
  <% end %>

  <div class="flex justify-between text-gray-600">
    <span><%= t('cart.shipping') %></span>
    <span class="text-sm"><%= t('cart.shipping_calculated') %></span>
  </div>
</div>

<!-- Coupon input -->
<% unless cart.coupon.present? %>
  <div class="mb-4">
    <%= form_with url: apply_coupon_cart_path, method: :post, local: true, class: "flex gap-2" do |f| %>
      <input type="text" name="coupon_code" placeholder="<%= t('cart.coupon_placeholder') %>" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-gray-400 focus:ring-0 focus:outline-none">
      <button type="submit" class="px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-lg text-sm transition duration-200 cursor-pointer">
        <%= t('cart.apply') %>
      </button>
    <% end %>
  </div>
<% end %>

<!-- Gift Card input -->
<% unless cart.gift_card.present? %>
  <div class="mb-6">
    <%= form_with url: apply_gift_card_cart_path, method: :post, local: true, class: "flex gap-2" do |f| %>
      <input type="text" name="gift_card_code" placeholder="<%= t('cart.gift_card_placeholder') %>" class="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm focus:border-purple-400 focus:ring-0 focus:outline-none uppercase">
      <button type="submit" class="px-4 py-2 bg-purple-100 hover:bg-purple-200 text-purple-700 font-medium rounded-lg text-sm transition duration-200 cursor-pointer">
        <%= t('cart.apply') %>
      </button>
    <% end %>
  </div>
<% end %>

<div class="border-t pt-4 mb-6">
  <div class="flex justify-between text-lg font-bold text-gray-900">
    <span><%= t('cart.total') %></span>
    <span><%= humanized_money_with_symbol(cart.total) %></span>
  </div>
</div>

<div data-controller="demo-modal" data-action="keydown@window->demo-modal#closeOnEscape">
  <!-- Checkout button triggers modal -->
  <button type="button" data-action="demo-modal#show" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-3 px-6 rounded-lg transition duration-200 cursor-pointer">
    <%= t('cart.checkout') %>
  </button>

  <!-- Hidden form for actual checkout -->
  <%= form_with url: checkout_path, method: :post, data: { turbo: false, demo_modal_target: "form" }, class: "hidden" do %>
  <% end %>

  <!-- Demo Warning Modal -->
  <div data-demo-modal-target="modal" data-action="click->demo-modal#closeOnBackground" class="hidden fixed inset-0 z-[9999] flex items-center justify-center bg-gray-900/50 backdrop-blur-sm">
    <div class="bg-white rounded-2xl shadow-2xl max-w-md mx-4 p-6 transform">
      <!-- Header -->
      <div class="text-center mb-4">
        <span class="text-4xl">üß™</span>
        <h3 class="text-xl font-bold text-gray-900 mt-2"><%= t('demo.modal_title', default: 'Demo Mode') %></h3>
      </div>

      <!-- Content -->
      <div class="text-gray-600 text-sm space-y-3 mb-6">
        <p><%= t('demo.modal_description', default: 'This is a live demo of Che Market. Stripe is configured in TEST mode, so no real charges will be made.') %></p>

        <div class="bg-gray-50 rounded-lg p-4">
          <p class="font-semibold text-gray-900 mb-2"><%= t('demo.test_card', default: 'Use this test card:') %></p>
          <div class="font-mono text-sm space-y-1">
            <p><span class="text-gray-500">Number:</span> <span class="text-gray-900">4242 4242 4242 4242</span></p>
            <p><span class="text-gray-500">Expiry:</span> <span class="text-gray-900">12/34</span></p>
            <p><span class="text-gray-500">CVC:</span> <span class="text-gray-900">123</span></p>
          </div>
        </div>

        <p class="text-xs text-gray-500"><%= t('demo.modal_note', default: 'You can use any valid-looking future date and any 3-digit CVC.') %></p>
      </div>

      <!-- Actions -->
      <div class="flex gap-3">
        <button type="button" data-action="demo-modal#close" class="flex-1 px-4 py-2.5 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition duration-200 cursor-pointer">
          <%= t('demo.cancel', default: 'Cancel') %>
        </button>
        <button type="button" data-action="demo-modal#proceed" class="flex-1 px-4 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition duration-200 cursor-pointer">
          <%= t('demo.proceed', default: 'Continue to Checkout') %>
        </button>
      </div>
    </div>
  </div>
</div>

<a href="<%= products_path %>" class="block text-center text-indigo-600 hover:text-indigo-800 mt-4">
  ‚Üê <%= t('cart.continue_shopping') %>
</a>
